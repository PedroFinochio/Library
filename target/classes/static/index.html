<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca</title>

    <!-- Fonte moderna -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1565c0, #90caf9);
            color: #333;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .book-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .book-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            width: 240px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .book-card:hover {
            transform: translateY(-5px);
        }

        .book-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
        }

        .book-title {
            font-weight: 600;
            font-size: 1.1em;
            margin: 10px 0 5px 0;
        }

        .book-author {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .book-price {
            color: #1565c0;
            font-weight: 600;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            color: white;
        }

        .update-btn {
            background-color: #1976d2;
        }

        .delete-btn {
            background-color: #e53935;
        }

        .update-btn:hover {
            background-color: #1565c0;
        }

        .delete-btn:hover {
            background-color: #c62828;
        }

        /* Modal styling */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 320px;
        }

        .modal-content input {
            width: 100%;
            padding: 8px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close-btn {
            background-color: #757575;
        }

        .close-btn:hover {
            background-color: #616161;
        }
    </style>
</head>

<body>
<h1>Biblioteca</h1>

<div class="book-container" id="bookContainer"></div>

<!-- Modal de atualização -->
<div class="modal" id="updateModal">
    <div class="modal-content">
        <h3>Atualizar Livro</h3>
        <input type="text" id="updateTitle" placeholder="Título">
        <input type="text" id="updateAuthor" placeholder="Autor">
        <input type="number" id="updatePrice" step="0.01" placeholder="Preço">
        <input type="text" id="updateImage" placeholder="URL da Imagem">
        <div class="modal-actions">
            <button class="close-btn" onclick="closeModal()">Cancelar</button>
            <button class="update-btn" onclick="saveUpdate()">Salvar</button>
        </div>
    </div>
</div>

<script>
    const API_URL = "http://localhost:8080/livros";
    const bookContainer = document.getElementById("bookContainer");
    const updateModal = document.getElementById("updateModal");
    let currentBookId = null;

    async function fetchBooks() {
        try {
            const res = await fetch(API_URL);
            const books = await res.json();
            displayBooks(books);
        } catch (e) {
            console.error("Erro ao buscar livros:", e);
        }
    }

    function displayBooks(books) {
        bookContainer.innerHTML = "";
        if (!books.length) {
            bookContainer.innerHTML = "<p style='color:white;font-size:1.1em;'>Nenhum livro encontrado.</p>";
            return;
        }

        books.forEach(book => {
            const card = document.createElement("div");
            card.className = "book-card";
            card.innerHTML = `
        <img src="${book.imageUrl || 'https://via.placeholder.com/200x300?text=Sem+Imagem'}" alt="${book.titulo}">
        <div class="book-title">${book.titulo}</div>
        <div class="book-author">${book.autor || 'Autor desconhecido'}</div>
        <div class="book-price">R$ ${book.preco.toFixed(2)}</div>
        <div class="button-group">
          <button class="update-btn" onclick="openModal(${book.id}, '${book.titulo}', '${book.autor}', ${book.preco}, '${book.imageUrl || ''}')">Atualizar</button>
          <button class="delete-btn" onclick="deleteBook(${book.id})">Excluir</button>
        </div>
      `;
            bookContainer.appendChild(card);
        });
    }

    function openModal(id, titulo, autor, preco, imageUrl) {
        currentBookId = id;
        document.getElementById("updateTitle").value = titulo;
        document.getElementById("updateAuthor").value = autor;
        document.getElementById("updatePrice").value = preco;
        document.getElementById("updateImage").value = imageUrl;
        updateModal.style.display = "flex";
    }

    function closeModal() {
        updateModal.style.display = "none";
    }

    async function saveUpdate() {
        const titulo = document.getElementById("updateTitle").value;
        const autor = document.getElementById("updateAuthor").value;
        const preco = parseFloat(document.getElementById("updatePrice").value);
        const imageUrl = document.getElementById("updateImage").value;

        if (!titulo || !autor || isNaN(preco)) {
            alert("Preencha todos os campos corretamente!");
            return;
        }

        await fetch(`${API_URL}/${currentBookId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: currentBookId, titulo, autor, preco, imageUrl })
        });

        closeModal();
        fetchBooks();
    }

    async function deleteBook(id) {
        if (!confirm("Tem certeza que deseja excluir este livro?")) return;

        await fetch(`${API_URL}/${id}`, {
            method: "DELETE"
        });

        fetchBooks();
    }

    fetchBooks();
</script>
</body>
</html>
